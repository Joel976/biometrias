1) Registrar biometría de oreja (enrolamiento)
POST /oreja/registrar

Propósito: Registrar una credencial biométrica de oreja para un usuario ya existente (busca el usuario por identificador_unico en tu API en http://167.71.155.9:3001), guarda imágenes en disco y ejecuta agregar_usuario_biometria.exe.

Tipo de envío

multipart/form-data

Campos requeridos

identificador (string): identificador único del usuario (ej: cédula).

7+ imágenes como archivos (cualquier nombre de campo sirve; el servidor solo verifica que req.files.size() >= 7).

El backend guarda todas las imágenes como:

nuevo_usuario/img_0.jpg, img_1.jpg, etc.

Nota: este endpoint no exige nombres específicos para las imágenes. Solo que vengan como files y sean al menos 7.

Respuestas

200: "Credencial biométrica registrada correctamente."

400: "Se requieren al menos 7 imágenes y el campo 'identificador'"

404: "Usuario no encontrado o respuesta inválida"

500: errores consultando usuario, guardando imágenes, escribiendo txt o ejecutando el proceso interno.

Ejemplo (curl)

curl -X POST "http://167.71.155.9:8080/oreja/registrar?identificador=0102030405" \
  -F "img1=@/ruta/a/1.jpg" \
  -F "img2=@/ruta/a/2.jpg" \
  -F "img3=@/ruta/a/3.jpg" \
  -F "img4=@/ruta/a/4.jpg" \
  -F "img5=@/ruta/a/5.jpg" \
  -F "img6=@/ruta/a/6.jpg" \
  -F "img7=@/ruta/a/7.jpg"


2) Registrar usuario (datos en JSON)
POST /registrar_usuario

Propósito: Registrar un usuario nuevo. Recibe JSON, lo guarda en nuevo_usuario/datos.json y ejecuta agregar_usuario.exe. Luego lee el id_usuario generado desde nuevo_usuario/id_usuario.txt.

Tipo de envío

application/json

Body (JSON)

El contenido exacto depende de lo que tu agregar_usuario.exe espera dentro de datos.json.

Este endpoint no valida campos específicos, solo valida que sea JSON válido.

Respuestas

201 (application/json):

{
  "mensaje": "Usuario registrado correctamente",
  "id_usuario": 123
}


Ejemplo (curl)

curl -X POST "http://167.71.155.9:8080/registrar_usuario" \
  -H "Content-Type: application/json" \
  -d '{
    "identificador_unico": "0102030405",
    "nombres": "Andres",
    "apellidos": "Garcia"
  }'


3) Eliminar usuario (soft delete)
POST /eliminar

Propósito: Marcar un usuario como eliminado (no lo borra físico).
Busca al usuario por identificador_unico en http://167.71.155.9:3001/usuarios?... y hace PATCH cambiando estado a "eliminado".

Tipo de envío

Parámetro por query (x-www-form-urlencoded también valdría, pero aquí lo usas como param).

Parámetros requeridos

identificador (string)

Respuestas

200: "Usuario eliminado"

200: "El usuario ya estaba marcado como eliminado"

400: "Falta parámetro 'identificador'"

404: "Usuario no encontrado"

500: errores consultando o parchando.
Ejemplo (curl)

curl -X POST "http://167.71.155.9:8080/eliminar?identificador=0102030405"


4) Restaurar usuario
POST /restaurar

Propósito: Revertir el eliminado lógico. Cambia estado a "activo".

Parámetros requeridos

identificador (string)

Respuestas

200: "Usuario restaurado exitosamente"

200: "El usuario ya estaba activo"

400: "Falta parámetro 'identificador'"

404: "Usuario no encontrado"

500: errores consultando o parchando.

Ejemplo (curl)

curl -X POST "http://167.71.155.9:8080/restaurar?identificador=0102030405"

5) Autenticación / Verificación biométrica (oreja)
POST /oreja/autenticar

Propósito: Verificar identidad usando una imagen de oreja.
Guarda imagen en tmp/imagen.jpg, consulta usuario por identificador_unico, verifica que tenga credencial biométrica activa, ejecuta predecir.exe y compara:

clase_predicha vs etiqueta (comparación string)

margen >= 0.25 (umbral fijo)

Además registra un log en /validaciones_biometricas con resultado exito/fallo.

Tipo de envío

multipart/form-data

Campos requeridos

archivo (file): imagen JPG/PNG (la guardas como jpg en disco).

etiqueta (string): “cedula” / identificador del usuario (tu mensaje de error dice cedula).

Respuestas

200 (application/json) si autenticado:

{
  "id_usuario": 1,
  "id_usuario_predicho": 0102030405,
  "margen": 0.31,
  "umbral": 0.25,
  "autenticado": true,
  "mensaje": "Identidad verificada correctamente"
}

401 (application/json) si no autenticado (no coincide o margen insuficiente)

403 (text/plain) en casos:

"Usuario no esta activo"

"El usuario no tiene credencial biometrica de tipo oreja activa"

"Usuario no identificado por el sistema" (si predecir devuelve clase -1)

400: "Se requiere imagen (campo 'archivo') y cedula (campo 'etiqueta')"

404: "Usuario no encontrado"

500: errores internos, formato inválido clase;margen, predicción vacía, etc.

Ejemplo (curl)

curl -X POST "http://167.71.155.9:8080/oreja/autenticar" \
  -F "archivo=@/ruta/a/oreja.jpg" \
  -F "etiqueta=0102030405"

